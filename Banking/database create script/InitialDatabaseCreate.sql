CREATE TABLE [dbo].[Customer] (
    [CustomerId] [int] NOT NULL IDENTITY,
    [UserName] [nvarchar](max),
    [FirstName] [nvarchar](max),
    [LastName] [nvarchar](max),
    [Phone] [nvarchar](max),
    [Email] [nvarchar](max),
    CONSTRAINT [PK_dbo.Customer] PRIMARY KEY ([CustomerId])
)
CREATE TABLE [dbo].[Address] (
    [AddressId] [int] NOT NULL IDENTITY,
    [Line1] [nvarchar](max),
    [Line2] [nvarchar](max),
    [City] [nvarchar](max),
    [Province] [nvarchar](max),
    [PostalCode] [nvarchar](max),
    [IsActive] [bit] NOT NULL,
    [CustomerId] [int] NOT NULL,
    CONSTRAINT [PK_dbo.Address] PRIMARY KEY ([AddressId])
)
CREATE INDEX [IX_CustomerId] ON [dbo].[Address]([CustomerId])
CREATE TABLE [dbo].[Account] (
    [AccountId] [int] NOT NULL IDENTITY,
    [AccountNumber] [nvarchar](max),
    [Type] [int] NOT NULL,
    [Category] [int] NOT NULL,
    [Balance] [decimal](18, 2) NOT NULL,
    [Created] [datetime] NOT NULL,
    [Modified] [datetime] NOT NULL,
    [IsActive] [bit] NOT NULL,
    [IsLocked] [bit] NOT NULL,
    [Timestamp] rowversion NOT NULL,
    CONSTRAINT [PK_dbo.Account] PRIMARY KEY ([AccountId])
)
CREATE TABLE [dbo].[Transaction] (
    [TransactionId] [int] NOT NULL IDENTITY,
    [LeftAccountId] [int] NOT NULL,
    [RightAccountId] [int] NOT NULL,
    [Value] [decimal](18, 2) NOT NULL,
    [Created] [datetime] NOT NULL,
    [Applied] [datetime],
    [Status] [int] NOT NULL,
    [Description] [nvarchar](max),
    CONSTRAINT [PK_dbo.Transaction] PRIMARY KEY ([TransactionId])
)
CREATE INDEX [IX_LeftAccountId] ON [dbo].[Transaction]([LeftAccountId])
CREATE INDEX [IX_RightAccountId] ON [dbo].[Transaction]([RightAccountId])
CREATE TABLE [dbo].[Investment] (
    [InvestmentId] [int] NOT NULL IDENTITY,
    [AccountId] [int] NOT NULL,
    [TermStart] [datetime] NOT NULL,
    [TermEnd] [datetime] NOT NULL,
    [Type] [int] NOT NULL,
    [CompoundingFrequency] [int] NOT NULL,
    CONSTRAINT [PK_dbo.Investment] PRIMARY KEY ([InvestmentId])
)
CREATE INDEX [IX_AccountId] ON [dbo].[Investment]([AccountId])
CREATE TABLE [dbo].[InvestmentInterval] (
    [InvestmentIntervalId] [int] NOT NULL IDENTITY,
    [Start] [datetime] NOT NULL,
    [End] [datetime] NOT NULL,
    [InterestRate] [float] NOT NULL,
    [StartingAmount] [decimal](18, 2) NOT NULL,
    [InvestmentId] [int] NOT NULL,
    CONSTRAINT [PK_dbo.InvestmentInterval] PRIMARY KEY ([InvestmentIntervalId])
)
CREATE INDEX [IX_InvestmentId] ON [dbo].[InvestmentInterval]([InvestmentId])
CREATE TABLE [dbo].[Log] (
    [LogId] [bigint] NOT NULL IDENTITY,
    [Created] [datetime] NOT NULL,
    [UserName] [nvarchar](max),
    [ErrorMessage] [nvarchar](max),
    [AdditionalData] [nvarchar](max),
    CONSTRAINT [PK_dbo.Log] PRIMARY KEY ([LogId])
)
CREATE TABLE [dbo].[CustomerAccounts] (
    [CustomerId] [int] NOT NULL,
    [AccountId] [int] NOT NULL,
    CONSTRAINT [PK_dbo.CustomerAccounts] PRIMARY KEY ([CustomerId], [AccountId])
)
CREATE INDEX [IX_CustomerId] ON [dbo].[CustomerAccounts]([CustomerId])
CREATE INDEX [IX_AccountId] ON [dbo].[CustomerAccounts]([AccountId])
ALTER TABLE [dbo].[Address] ADD CONSTRAINT [FK_dbo.Address_dbo.Customer_CustomerId] FOREIGN KEY ([CustomerId]) REFERENCES [dbo].[Customer] ([CustomerId])
ALTER TABLE [dbo].[Transaction] ADD CONSTRAINT [FK_dbo.Transaction_dbo.Account_LeftAccountId] FOREIGN KEY ([LeftAccountId]) REFERENCES [dbo].[Account] ([AccountId])
ALTER TABLE [dbo].[Transaction] ADD CONSTRAINT [FK_dbo.Transaction_dbo.Account_RightAccountId] FOREIGN KEY ([RightAccountId]) REFERENCES [dbo].[Account] ([AccountId])
ALTER TABLE [dbo].[Investment] ADD CONSTRAINT [FK_dbo.Investment_dbo.Account_AccountId] FOREIGN KEY ([AccountId]) REFERENCES [dbo].[Account] ([AccountId])
ALTER TABLE [dbo].[InvestmentInterval] ADD CONSTRAINT [FK_dbo.InvestmentInterval_dbo.Investment_InvestmentId] FOREIGN KEY ([InvestmentId]) REFERENCES [dbo].[Investment] ([InvestmentId])
ALTER TABLE [dbo].[CustomerAccounts] ADD CONSTRAINT [FK_dbo.CustomerAccounts_dbo.Customer_CustomerId] FOREIGN KEY ([CustomerId]) REFERENCES [dbo].[Customer] ([CustomerId]) ON DELETE CASCADE
ALTER TABLE [dbo].[CustomerAccounts] ADD CONSTRAINT [FK_dbo.CustomerAccounts_dbo.Account_AccountId] FOREIGN KEY ([AccountId]) REFERENCES [dbo].[Account] ([AccountId]) ON DELETE CASCADE
CREATE TABLE [dbo].[__MigrationHistory] (
    [MigrationId] [nvarchar](255) NOT NULL,
    [Model] [varbinary](max) NOT NULL,
    [ProductVersion] [nvarchar](32) NOT NULL,
    CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId])
)
BEGIN TRY
    EXEC sp_MS_marksystemobject 'dbo.__MigrationHistory'
END TRY
BEGIN CATCH
END CATCH
INSERT INTO [__MigrationHistory] ([MigrationId], [Model], [ProductVersion]) VALUES ('201404161458109_InitialDatabaseCreate', 0x1F8B0800000000000400ED5DDB6E23B9117D0F907F10F4940458CBE31904B30379171ED90E8CB5C713CB33409E0674372513D3176D77CB6B7F5B1EF249F98525FBCAFBA59B2DC99BBC596CF2902C56158B4556F9BFFFFECFFCE7E7389A3CC12C4769723A7D73743C9DC024484394AC4FA7DB62F5C3FBE9CF3FFDF94FF38B307E9E7C6DEABD25F570CB243F9D3E16C5E6C36C96078F3006F9518C822CCDD3557114A4F10C84E9ECE4F8F8C7D99B37338821A6186B3299DF6D9302C5B0FC817F2ED224809B620BA29B3484515E97E32FCB1275F209C430DF80009E4E3F82E43B1EDCD1D96613A10014783C47E767D7D3C95984001ECE1246ABE964F3EEC3971C2E8B2C4DD6CB0DAE05A2FB970DC4DF5720CA613DF80F9B77B6E33F3E21E39F8124498BB2D35EF39FB633C373BBC034285EC8B0CAF99D4E17DBBC4863989544A0ABE2CABFC017A600177DCED20DCC8A973BB8E200AEC2E964C6B69FF1006D73495B32A6D3E95552BC3D994E3E6DA3083C44B0251DA6EDB24833F80F98C00C1430FC0C8A0266982DAE4258CE49E89DEB0B2F4D46FE6A7AC2EB8497743AB944CF30BC86C9BA786C7BBB01CF4D09FE733AF99220CC9EB851916D213DBAEAB7BEE34B94E5C55E7ABE067BEAF8F3639AECBED78B18A068FC5E3F8127B42EC591EBFF2C0C3398E7309F4EEE6054D6C81FD1A6520F47F5D752CEBE358C8FC797A5F15D1A75CDD90ADFEE41B686059E55AAABB54CB759E032D42048B13A948F945109DFBAAADD50E535DA51346355546BA6440F763EEB3493565FD1F3EFA3AEEAF67DB415D5746C65758D12F866F7FA02F77AB2F35E17253D76ADA1B2F40925C11E54639A17205AE0F63BEFFA2A3F0B0AF4D476FC31C5520A1209031B16CC7AD7B655479D3AF4A7387965A457AFBD7411310B6BADD65F1F55ED7BE9A3AEE9D8FAA8EEEAD3367E20B4DF31E392EEDA4E4B96A886535AD7EEEC8B29B04EB3171962FD0DF580FD08224029947318A0186073E47386FFAA4F3AEFA793650008A485B4F0C3CE2059BA161FFFB8473174C6C19C8A56C803902F7572955FA7C1F76E407D71C824B06E8D372D104A00596672D2DB66193E62BEDC943C5832AC916FDF3B49D2228D37DB727D6C95DEED6F18C3B305C65B8B0643AD97D6BBCF409283800CB9B7D6A330FA683EAEF9E8D6185C15D6CA560F7587D68FBEB0BE82687BF8FAA6F499E8716CF68065018A6DCEE86C8A0B9AAF8E633B877990A14DE55AD9DBB991622FA936E005EE1BD3A0D309BA7A8239A4AD2CB38A7433A0B9DA6E0A6C0BCD1CE88AE64930B507D97657C913DE4D6238C0B4EB20FAE838B6F58E0CBCA12AE91E663196C5AC18AC3608D245325CFD08B66347D79EE623DEE831A988B3FA3283BF6E8959C17420AFD0FB6CA4132B8E49BF49044A51451025553D575540B16D8259F0094FD630F4A65ED56F572E9F85AAB660FA583419640629F0072A8A1A6AA0C2A050C6561C7EA4DD87A497B3C614B8C3002D58BAC500CE50E5A4B0FC9EC595388D6462B9A87877F9DB8DD8A9F58851527B89DD75BAEE2D67B86D1FC1AA9BB5EBF3F777A348922F837B6F175D175996663730CFC17AF79D9F852122BC0E224C383072F76A6EDDC6F45D05E3A6BACA2F23B0EE6E83BF2421CCA2173C3E5AF2D949DE40E2706B18E41106DFCBE99427BFD3E9B14014A6FE12EB88649DB7D5DFE8ABD32AA06E71A26F51F17A740DC335CC16207F6C1BBE15E95551C64C2DDA0537986467790E0B5B7A5D23F080A25252E514B39A86E4543A7C1ACD19DA6E229F61697DDA2EFC254011057ED263D282513D78CAA5C4565BB9DDA4BF820C117965DAF45940B9FD3E7842FF8200D7B79DCD3FB7D802817403ABA9607E4F03546EFA92FBD2EEF684ED195B5F13ABAB14CA5F4E5FC34E6EB65181C8D3182C3CA7D3BF09533375D0DAEED4298A7997C2F5203234DEE4B1F1979037370B6CF014194049215A042809D006443683E11A3BBE7D210BD476C77F39871B2CA178B436541F3E8EB63BCEEE31D16C3EA3D849CF650A87B58A0B4CEF072CD940C768260779D785708BA7EFC5812A5AC79D6AE0765E3CA917D49948564E40075279924B9B61D98885F26ED5493A6D16C46634DC2DC25EE454EF87B56613B95376249E94FA740F802965E3DA2357CAD6C46638FC8DD45EF852E5C8543189D1AB29F3F73AB3A2C927BA7B26348C6877EC675880C103D929CF295D6166C630FBC5649CC87A8C7B71A4D90F6E2D02DE79D334361BEED05D9EF5E454D35AF9189677BEAD1C4DB84D815BB4C743A26ECE3F9252F82CB22969B18405679BE35379E7B5929BD702DFB148D4036701893D109A80DA172D028EA8480D58D44628C3134D11035EB7C232384194ACD1A8EB300D2AA7190CE8D7E95A06D7FAC8F9F6148F09ABCABFAFA4EA6A1F62F22260EB4C68E7C2F0952051B6AE030A8E6278DED5CF12C08238AA975822756C8EC02E87609B09B99C78697AB7D3184C1FFDDB14914AF64762F74331354356296888667502DE11E9D8373116B4531FDE7A1CDFBC504F7A561B877CCAB70F22E1AC4E174EE70B6A4ACC7EA1A195E930313695D4F7BD3A82D999C67D8D632919A98DD28A9C464BD86EB134C46DAEFB5A2BACFD369F55C1A275C17CA6882A9DDF80CD865CC6752DEB92C9B20A315DFCB0748FEE8C2B8C59C0EC33BCCDD8F654A4195843EE2BB9F0086119A4486E4E1F00B9DD5884B150CDCAE66CFAE24D4F71211B9BA56941FEEE8C5B49B42D67AC8AD67A8D7489274956B89C2F946CA38AF61312F90B229069C25D1669B48D13B3D35D8DD6DDCED3585DA93D1215574A4351C5F6585DA4280DD595DA23D5A19F344C5D648F510772D218759188319F71CB2E1CC90456E3C49EE75D2BCEEE4C561F9CAD0E6A2C214D8CAD6FAEA23215CE48535A1920A9E59F2A5E91619EAAC80DE344C410DE20E830AA5842464A252F6F74085D6020C3C26DA9031215E9C76051E5F6685DB40D8DD5953AD0A8973EDB979CA9CF51EE62A68FD72B614DA26686508A5BE7EE64C44DED05356235E17812BCE6933D66F5509A86AA4A1C18AB0DAC63D8AA2DB5476A63E968A0B6D06144CD933A66404DA13D4E1733470375A5FB10E32E6C8E456A4A1D56BE0B9C6396BF2B3E1875C09C4C7DA8047D305B096B5209660825E1D9303686F8BA00391D2677CBCCECA6FA0B6835267F4548839AAE0FD5A875F81A0D5617ED5EC0DB07768C2A6D0AED719A177F344C53668FC284A5D150CC8783114AFA50ED4326B5A15725AA49248D084AA5CA5CEF308A557BF1A3E12C8FDB3E155DC5E88AAED80DAB8CBAE091CAC29D9A0DD2F7968C404B6B1C20FF77AE2BBF72A089302AD1EDE5C180642117546C91423E94314CBA1E247CEDCCD3023F3BF2321B41C4CE8EFEE2382B2A9048981EF5CD659C7DB5D49E24A4BCA7F42112F2E89F12CE2403EAA64A53AA8AFB614C285904910EC39781E2CF6DC846E930D2C27C71D8E2B8D01BCE9BC47CDB3D4BB25E7DB97F9ABFDD75F445532DB53E6793F3805C6F289C35F24B629198DE3C3E84ACED607A8F53F9E0C793ADA41E257F9D23F28670ABC3576939B3BDDDE16E71E6F58D0A73D53391251015AE58AA2A2494347D4221B95E59BEE4058C8F4885A3E5AFD1021F3DC8AED054B801095A61DD7E9F7E87C9E9F4E4F8F83D977EB4476AD0599E8791E4EA888E8639ACFCA088D0C4186839306232790259F008B2BFC4E0F9AF83D37D0E42E353780E0263D2720E4262526D3A20BDCA348FA3F01C93E171188BD0591B0721D1991887311A975D711898903171101C9FB6EC01151E3220963CA24579B5590547617F6942C141EB4A277A31AF86644DB9B4807D30B81C80E1C839B942FCA3F09103B037900F61E2F3FFF5C11072FF65E96F75827925EF7619FBFCC8EDA1E6C51B67FB92A5C4EB2332F284787D90987478072B7A5C3A3C198E7B3ABC3EE492E4BE1BC3903BC83C6A636E69C3985848A0D69BD1B8046AFD7186EEAB9A7C691EADA657958E6B14FEF3C3363E584696896B15A5C09D79E489B8BC2B77A58EF0C39BFBCE59F580D6A3709CAF3DD1ABFF4596856A10A03CB3D4187BA583B378A8EFCDF7A9B1CF89D8CB16AA22EED04C385C6464FFCC34F200B601C9747A05E79ADECE3BF24EBFDC36AF23974DAFAC2D62D8EAA0E400EA10AB8179367A318FC5BBD95DA5B9F883675AF93F1B1D101BBDCACC28A3719010F93E24C7CA6BE31FF39344C79E5F4B7E13E7B5B663212ECD818F24293EF2E91C446692C3CC43629BF34FFA34C5875DCD4FF1363987112CE0E42CA8229717200F801854553E11B11A8D56751A6AFEB18C76A7574B8769C53B3C48F2B77BFE0FF2E81E37E5E15CBADB2D9A7B6ED6FAC7F9E87B9E11E4E99CEA45EDBC1F72355A3D343B9D860F29E695CA8DD225F911B66A69C2275557EC67594F750D634722B30A9D8955A41D3659400C1D8A471EA143B18AAC43AA96B153C17412FA146AC8BAA4737758F7C859539A9EB99AFA1134958D23E97252095D779F647DE1AF467083E2D3CB881D63354D94B959769B5B4BAA0524592E44BDA6F2475210DA5C6E079B234AB5EEF2B86D1D6154CA411EEE390281C6CA04F57A49346AB6277F645168786950A24FA2EC21B993F304ED5C01523C7D56445F59FDDAB454B6C9FD1461189ED5B4D5E666116C321AD99A3C5BD6649347858C2290BB279E43B230317C049F2E709728AEAE32F1892747EB0E628E31131830E78AB6CE55B24A9B130E37A2A60AFF0A141620C4878EB3AC402BACAEF1E7006FFBF47F8EB9881F607895DC6E8BCDB620FF4C277E8898D05B724CD2F55F664463C73CBF2D1F9DE53EA6808789C8B383DBE4E31645DDFFB0B9945C142B20C8F9AB7E1341D6B2206F23D6DDBF5DF924E4AE5201D5E46B8F8DF730DE44182CBF4D96E009AAC766A6214BB1F93902EB0CC4798DD1B5C73F31FB85F1F34FBF03B7535CCF67890000, '5.0.0.net45')
